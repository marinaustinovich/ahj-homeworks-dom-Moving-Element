(()=>{"use strict";function e(e,t){const l=e<t,s=e>=t*(t-1),i=e%t==0,n=(e+1)%t==0;return l&&i?"top-left":l&&n?"top-right":s&&i?"bottom-left":s&&n?"bottom-right":l?"top":s?"bottom":i?"left":n?"right":"center"}let t=null;function l(e){const l=function(e){const t=e**2;return Array.from({length:t/8},((e,t)=>8*t)).flatMap((e=>[e,e+1]))}(e);let s;do{s=Math.floor(Math.random()*l.length)}while(l[s]===t);return t=l[s],t}const s={auto:"auto",pointer:"pointer",crosshair:"crosshair",notallowed:"not-allowed"};const i=new class{constructor(e){this.boardSize=e,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(t){this.checkBinding(),this.container.innerHTML='\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(let t=0;t<this.boardSize**2;t+=1){const l=document.createElement("div");l.classList.add("cell","map-tile",`map-tile-${e(t,this.boardSize)}`),l.addEventListener("mouseenter",(e=>this.onCellEnter(e))),l.addEventListener("mouseleave",(e=>this.onCellLeave(e))),l.addEventListener("click",(e=>this.onCellClick(e))),this.boardEl.appendChild(l)}this.cells=Array.from(this.boardEl.children)}redrawPositions(e){for(const e of this.cells)e.innerHTML="";const t=this.boardEl.children[e],l=document.createElement("div");l.classList.add("character","generic"),t.appendChild(l)}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addCellClickListener(e){this.cellClickListeners.push(e)}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach((e=>e.call(null,t)))}onCellLeave(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach((e=>e.call(null,t)))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach((e=>e.call(null,t)))}selectCell(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"red";this.deselectCell(e),this.cells[e].classList.add("selected",`selected-${t}`)}deselectCell(e){const t=this.cells[e];t.classList.remove(...Array.from(t.classList).filter((e=>e.startsWith("selected"))))}hideCellTooltip(e){this.cells[e].title=""}setCursor(e){this.boardEl.style.cursor=e}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}(4);i.bindToDOM(document.querySelector("#game-container"));const n=new class{constructor(e){this.gamePlay=e,this.indexSelect={},this.onCellClick=this.onCellClick.bind(this),this.onCellEnter=this.onCellEnter.bind(this),this.onCellLeave=this.onCellLeave.bind(this)}init(){this.events(),this.gamePlay.drawUi("prairie"),this.showCharacter()}events(){this.gamePlay.addCellEnterListener(this.onCellEnter),this.gamePlay.addCellLeaveListener(this.onCellLeave),this.gamePlay.addCellClickListener(this.onCellClick)}onCellClick(e){this.gamePlay.setCursor(s.crosshair),document.querySelector(".selected-red")&&this.gamePlay.deselectCell(this.indexSelect.red),this.gamePlay.selectCell(e),this.indexSelect.red=e}onCellEnter(){this.gamePlay.setCursor(s.pointer)}onCellLeave(e){this.gamePlay.hideCellTooltip(e)}showCharacter(){const e=setInterval((()=>{const e=l(this.gamePlay.boardSize);this.gamePlay.redrawPositions(e)}),1e3);setTimeout((()=>clearInterval(e)),1e6)}}(i);n.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S3NELFlBQWMsQ0FBQyxFQUNwQnRELEtBQUt1QixZQUFjdkIsS0FBS3VCLFlBQVlnQyxLQUFLdkQsTUFDekNBLEtBQUtxQixZQUFjckIsS0FBS3FCLFlBQVlrQyxLQUFLdkQsTUFDekNBLEtBQUtzQixZQUFjdEIsS0FBS3NCLFlBQVlpQyxLQUFLdkQsS0FDM0MsQ0FFQXdELE9BQ0V4RCxLQUFLeUQsU0FDTHpELEtBQUtGLFNBQVNXLE9BQU8sV0FDckJULEtBQUswRCxlQUNQLENBRUFELFNBQ0V6RCxLQUFLRixTQUFTK0IscUJBQXFCN0IsS0FBS3FCLGFBQ3hDckIsS0FBS0YsU0FBU2tDLHFCQUFxQmhDLEtBQUtzQixhQUN4Q3RCLEtBQUtGLFNBQVNtQyxxQkFBcUJqQyxLQUFLdUIsWUFDMUMsQ0FFQUEsWUFBWW5ELEdBQ1Y0QixLQUFLRixTQUFTb0QsVUFBVVMsRUFBQUEsV0FDcEIxQyxTQUFTSixjQUFjLGtCQUN6QmIsS0FBS0YsU0FBUzhDLGFBQWE1QyxLQUFLc0QsWUFBWU0sS0FHOUM1RCxLQUFLRixTQUFTMEMsV0FBV3BFLEdBQ3pCNEIsS0FBS3NELFlBQVlNLElBQU14RixDQUN6QixDQUVBaUQsY0FDRXJCLEtBQUtGLFNBQVNvRCxVQUFVUyxFQUFBQSxRQUMxQixDQUVBckMsWUFBWWxELEdBQ1Y0QixLQUFLRixTQUFTa0QsZ0JBQWdCNUUsRUFDaEMsQ0FFQXNGLGdCQUNFLE1BQU1HLEVBQVVDLGFBQVksS0FDMUIsTUFBTW5DLEVBQVdoRCxFQUFlcUIsS0FBS0YsU0FBU3pCLFdBQzlDMkIsS0FBS0YsU0FBUzRCLGdCQUFnQkMsRUFBUyxHQUN0QyxLQUVIb0MsWUFBVyxJQUFNQyxjQUFjSCxJQUFVLElBQzNDLEdGM0NrQy9ELEdBQ3BDdUQsRUFBU0csTSIsInNvdXJjZXMiOlsid2VicGFjazovL21vdmluZy1lbGVtZW50Ly4vc3JjL2pzL3V0aWxzLmpzIiwid2VicGFjazovL21vdmluZy1lbGVtZW50Ly4vc3JjL2pzL2NyZWF0ZVBvc2l0aW9uLmpzIiwid2VicGFjazovL21vdmluZy1lbGVtZW50Ly4vc3JjL2pzL2N1cnNvcnMuanMiLCJ3ZWJwYWNrOi8vbW92aW5nLWVsZW1lbnQvLi9zcmMvanMvYXBwLmpzIiwid2VicGFjazovL21vdmluZy1lbGVtZW50Ly4vc3JjL2pzL0dhbWVQbGF5LmpzIiwid2VicGFjazovL21vdmluZy1lbGVtZW50Ly4vc3JjL2pzL0dhbWVDb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNhbGNUaWxlVHlwZShpbmRleCwgYm9hcmRTaXplKSB7XG4gIGNvbnN0IGlzVG9wUm93ID0gaW5kZXggPCBib2FyZFNpemU7XG4gIGNvbnN0IGlzQm90dG9tUm93ID0gaW5kZXggPj0gYm9hcmRTaXplICogKGJvYXJkU2l6ZSAtIDEpO1xuICBjb25zdCBpc0xlZnRDb2x1bW4gPSBpbmRleCAlIGJvYXJkU2l6ZSA9PT0gMDtcbiAgY29uc3QgaXNSaWdodENvbHVtbiA9IChpbmRleCArIDEpICUgYm9hcmRTaXplID09PSAwO1xuXG4gIGlmIChpc1RvcFJvdyAmJiBpc0xlZnRDb2x1bW4pIHJldHVybiAndG9wLWxlZnQnO1xuICBpZiAoaXNUb3BSb3cgJiYgaXNSaWdodENvbHVtbikgcmV0dXJuICd0b3AtcmlnaHQnO1xuICBpZiAoaXNCb3R0b21Sb3cgJiYgaXNMZWZ0Q29sdW1uKSByZXR1cm4gJ2JvdHRvbS1sZWZ0JztcbiAgaWYgKGlzQm90dG9tUm93ICYmIGlzUmlnaHRDb2x1bW4pIHJldHVybiAnYm90dG9tLXJpZ2h0JztcbiAgaWYgKGlzVG9wUm93KSByZXR1cm4gJ3RvcCc7XG4gIGlmIChpc0JvdHRvbVJvdykgcmV0dXJuICdib3R0b20nO1xuICBpZiAoaXNMZWZ0Q29sdW1uKSByZXR1cm4gJ2xlZnQnO1xuICBpZiAoaXNSaWdodENvbHVtbikgcmV0dXJuICdyaWdodCc7XG4gIHJldHVybiAnY2VudGVyJztcbn1cbiIsImxldCBsYXN0UG9zaXRpb24gPSBudWxsO1xuXG5mdW5jdGlvbiBjcmVhdGVBcnJheVBvc2l0aW9ucyhib2FyZFNpemUpIHtcbiAgY29uc3QgdG90YWxDZWxscyA9IGJvYXJkU2l6ZSAqKiAyO1xuICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogdG90YWxDZWxscyAvIDggfSwgKF8sIGkpID0+IGkgKiA4KS5mbGF0TWFwKFxuICAgIChjZWxsKSA9PiBbY2VsbCwgY2VsbCArIDFdLFxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbihib2FyZFNpemUpIHtcbiAgY29uc3QgY2VsbHMgPSBjcmVhdGVBcnJheVBvc2l0aW9ucyhib2FyZFNpemUpO1xuICBsZXQgcmFuZDtcblxuICBkbyB7XG4gICAgcmFuZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNlbGxzLmxlbmd0aCk7XG4gIH0gd2hpbGUgKGNlbGxzW3JhbmRdID09PSBsYXN0UG9zaXRpb24pO1xuXG4gIGxhc3RQb3NpdGlvbiA9IGNlbGxzW3JhbmRdO1xuICByZXR1cm4gbGFzdFBvc2l0aW9uO1xufVxuIiwiY29uc3QgY3Vyc29ycyA9IHtcbiAgYXV0bzogJ2F1dG8nLFxuICBwb2ludGVyOiAncG9pbnRlcicsXG4gIGNyb3NzaGFpcjogJ2Nyb3NzaGFpcicsXG4gIG5vdGFsbG93ZWQ6ICdub3QtYWxsb3dlZCcsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjdXJzb3JzO1xuIiwiaW1wb3J0IEdhbWVQbGF5IGZyb20gJy4vR2FtZVBsYXknO1xuaW1wb3J0IEdhbWVDb250cm9sbGVyIGZyb20gJy4vR2FtZUNvbnRyb2xsZXInO1xuXG5jb25zdCBnYW1lUGxheSA9IG5ldyBHYW1lUGxheSg0KTtcbmdhbWVQbGF5LmJpbmRUb0RPTShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2FtZS1jb250YWluZXInKSk7XG5cbmNvbnN0IGdhbWVDdHJsID0gbmV3IEdhbWVDb250cm9sbGVyKGdhbWVQbGF5KTtcbmdhbWVDdHJsLmluaXQoKTtcbiIsImltcG9ydCBjYWxjVGlsZVR5cGUgZnJvbSAnLi91dGlscyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVQbGF5IHtcbiAgY29uc3RydWN0b3IoYm9hcmRTaXplKSB7XG4gICAgdGhpcy5ib2FyZFNpemUgPSBib2FyZFNpemU7XG4gICAgdGhpcy5jb250YWluZXIgPSBudWxsO1xuICAgIHRoaXMuYm9hcmRFbCA9IG51bGw7XG4gICAgdGhpcy5jZWxscyA9IFtdO1xuICAgIHRoaXMuY2VsbENsaWNrTGlzdGVuZXJzID0gW107XG4gICAgdGhpcy5jZWxsRW50ZXJMaXN0ZW5lcnMgPSBbXTtcbiAgICB0aGlzLmNlbGxMZWF2ZUxpc3RlbmVycyA9IFtdO1xuICB9XG5cbiAgYmluZFRvRE9NKGNvbnRhaW5lcikge1xuICAgIGlmICghKGNvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb250YWluZXIgaXMgbm90IEhUTUxFbGVtZW50Jyk7XG4gICAgfVxuICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICB9XG5cbiAgZHJhd1VpKHRoZW1lKSB7XG4gICAgdGhpcy5jaGVja0JpbmRpbmcoKTtcblxuICAgIHRoaXMuY29udGFpbmVyLmlubmVySFRNTCA9IGBcbiAgICAgIDxkaXYgY2xhc3M9XCJib2FyZC1jb250YWluZXJcIj5cbiAgICAgICAgPGRpdiBkYXRhLWlkPVwiYm9hcmRcIiBjbGFzcz1cImJvYXJkXCI+PC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgdGhpcy5ib2FyZEVsID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcignW2RhdGEtaWQ9Ym9hcmRdJyk7XG5cbiAgICB0aGlzLmJvYXJkRWwuY2xhc3NMaXN0LmFkZCh0aGVtZSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJvYXJkU2l6ZSAqKiAyOyBpICs9IDEpIHtcbiAgICAgIGNvbnN0IGNlbGxFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgY2VsbEVsLmNsYXNzTGlzdC5hZGQoJ2NlbGwnLCAnbWFwLXRpbGUnLCBgbWFwLXRpbGUtJHtjYWxjVGlsZVR5cGUoaSwgdGhpcy5ib2FyZFNpemUpfWApO1xuICAgICAgY2VsbEVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoZXZlbnQpID0+IHRoaXMub25DZWxsRW50ZXIoZXZlbnQpKTtcbiAgICAgIGNlbGxFbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKGV2ZW50KSA9PiB0aGlzLm9uQ2VsbExlYXZlKGV2ZW50KSk7XG4gICAgICBjZWxsRWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHRoaXMub25DZWxsQ2xpY2soZXZlbnQpKTtcbiAgICAgIHRoaXMuYm9hcmRFbC5hcHBlbmRDaGlsZChjZWxsRWwpO1xuICAgIH1cblxuICAgIHRoaXMuY2VsbHMgPSBBcnJheS5mcm9tKHRoaXMuYm9hcmRFbC5jaGlsZHJlbik7XG4gIH1cblxuICByZWRyYXdQb3NpdGlvbnMocG9zaXRpb24pIHtcbiAgICBmb3IgKGNvbnN0IGNlbGwgb2YgdGhpcy5jZWxscykge1xuICAgICAgY2VsbC5pbm5lckhUTUwgPSAnJztcbiAgICB9XG5cbiAgICBjb25zdCBjZWxsRWwgPSB0aGlzLmJvYXJkRWwuY2hpbGRyZW5bcG9zaXRpb25dO1xuICAgIGNvbnN0IGNoYXJFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNoYXJFbC5jbGFzc0xpc3QuYWRkKCdjaGFyYWN0ZXInLCAnZ2VuZXJpYycpO1xuXG4gICAgY2VsbEVsLmFwcGVuZENoaWxkKGNoYXJFbCk7XG4gIH1cblxuICBhZGRDZWxsRW50ZXJMaXN0ZW5lcihjYWxsYmFjaykge1xuICAgIHRoaXMuY2VsbEVudGVyTGlzdGVuZXJzLnB1c2goY2FsbGJhY2spO1xuICB9XG5cbiAgYWRkQ2VsbExlYXZlTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgICB0aGlzLmNlbGxMZWF2ZUxpc3RlbmVycy5wdXNoKGNhbGxiYWNrKTtcbiAgfVxuXG4gIGFkZENlbGxDbGlja0xpc3RlbmVyKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5jZWxsQ2xpY2tMaXN0ZW5lcnMucHVzaChjYWxsYmFjayk7XG4gIH1cblxuICBvbkNlbGxFbnRlcihldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmNlbGxzLmluZGV4T2YoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gICAgdGhpcy5jZWxsRW50ZXJMaXN0ZW5lcnMuZm9yRWFjaCgobykgPT4gby5jYWxsKG51bGwsIGluZGV4KSk7XG4gIH1cblxuICBvbkNlbGxMZWF2ZShldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmNlbGxzLmluZGV4T2YoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gICAgdGhpcy5jZWxsTGVhdmVMaXN0ZW5lcnMuZm9yRWFjaCgobykgPT4gby5jYWxsKG51bGwsIGluZGV4KSk7XG4gIH1cblxuICBvbkNlbGxDbGljayhldmVudCkge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jZWxscy5pbmRleE9mKGV2ZW50LmN1cnJlbnRUYXJnZXQpO1xuICAgIHRoaXMuY2VsbENsaWNrTGlzdGVuZXJzLmZvckVhY2goKG8pID0+IG8uY2FsbChudWxsLCBpbmRleCkpO1xuICB9XG5cbiAgc2VsZWN0Q2VsbChpbmRleCwgY29sb3IgPSAncmVkJykge1xuICAgIHRoaXMuZGVzZWxlY3RDZWxsKGluZGV4KTtcbiAgICB0aGlzLmNlbGxzW2luZGV4XS5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcsIGBzZWxlY3RlZC0ke2NvbG9yfWApO1xuICB9XG5cbiAgZGVzZWxlY3RDZWxsKGluZGV4KSB7XG4gICAgY29uc3QgY2VsbCA9IHRoaXMuY2VsbHNbaW5kZXhdO1xuICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZSguLi5BcnJheS5mcm9tKGNlbGwuY2xhc3NMaXN0KVxuICAgICAgLmZpbHRlcigobykgPT4gby5zdGFydHNXaXRoKCdzZWxlY3RlZCcpKSk7XG4gIH1cblxuICBoaWRlQ2VsbFRvb2x0aXAoaW5kZXgpIHtcbiAgICB0aGlzLmNlbGxzW2luZGV4XS50aXRsZSA9ICcnO1xuICB9XG5cbiAgc2V0Q3Vyc29yKGN1cnNvcikge1xuICAgIHRoaXMuYm9hcmRFbC5zdHlsZS5jdXJzb3IgPSBjdXJzb3I7XG4gIH1cblxuICBjaGVja0JpbmRpbmcoKSB7XG4gICAgaWYgKHRoaXMuY29udGFpbmVyID09PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0dhbWVQbGF5IG5vdCBiaW5kIHRvIERPTScpO1xuICAgIH1cbiAgfVxufVxuIiwiaW1wb3J0IGNyZWF0ZVBvc2l0aW9uIGZyb20gJy4vY3JlYXRlUG9zaXRpb24nO1xuaW1wb3J0IGN1cnNvcnMgZnJvbSAnLi9jdXJzb3JzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZUNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihnYW1lUGxheSkge1xuICAgIHRoaXMuZ2FtZVBsYXkgPSBnYW1lUGxheTtcbiAgICB0aGlzLmluZGV4U2VsZWN0ID0ge307XG4gICAgdGhpcy5vbkNlbGxDbGljayA9IHRoaXMub25DZWxsQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uQ2VsbEVudGVyID0gdGhpcy5vbkNlbGxFbnRlci5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DZWxsTGVhdmUgPSB0aGlzLm9uQ2VsbExlYXZlLmJpbmQodGhpcyk7XG4gIH1cblxuICBpbml0KCkge1xuICAgIHRoaXMuZXZlbnRzKCk7XG4gICAgdGhpcy5nYW1lUGxheS5kcmF3VWkoJ3ByYWlyaWUnKTtcbiAgICB0aGlzLnNob3dDaGFyYWN0ZXIoKTtcbiAgfVxuXG4gIGV2ZW50cygpIHtcbiAgICB0aGlzLmdhbWVQbGF5LmFkZENlbGxFbnRlckxpc3RlbmVyKHRoaXMub25DZWxsRW50ZXIpO1xuICAgIHRoaXMuZ2FtZVBsYXkuYWRkQ2VsbExlYXZlTGlzdGVuZXIodGhpcy5vbkNlbGxMZWF2ZSk7XG4gICAgdGhpcy5nYW1lUGxheS5hZGRDZWxsQ2xpY2tMaXN0ZW5lcih0aGlzLm9uQ2VsbENsaWNrKTtcbiAgfVxuXG4gIG9uQ2VsbENsaWNrKGluZGV4KSB7XG4gICAgdGhpcy5nYW1lUGxheS5zZXRDdXJzb3IoY3Vyc29ycy5jcm9zc2hhaXIpO1xuICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VsZWN0ZWQtcmVkJykpIHtcbiAgICAgIHRoaXMuZ2FtZVBsYXkuZGVzZWxlY3RDZWxsKHRoaXMuaW5kZXhTZWxlY3QucmVkKTtcbiAgICB9XG5cbiAgICB0aGlzLmdhbWVQbGF5LnNlbGVjdENlbGwoaW5kZXgpO1xuICAgIHRoaXMuaW5kZXhTZWxlY3QucmVkID0gaW5kZXg7XG4gIH1cblxuICBvbkNlbGxFbnRlcigpIHtcbiAgICB0aGlzLmdhbWVQbGF5LnNldEN1cnNvcihjdXJzb3JzLnBvaW50ZXIpO1xuICB9XG5cbiAgb25DZWxsTGVhdmUoaW5kZXgpIHtcbiAgICB0aGlzLmdhbWVQbGF5LmhpZGVDZWxsVG9vbHRpcChpbmRleCk7XG4gIH1cblxuICBzaG93Q2hhcmFjdGVyKCkge1xuICAgIGNvbnN0IHRpbWVySWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICBjb25zdCBwb3NpdGlvbiA9IGNyZWF0ZVBvc2l0aW9uKHRoaXMuZ2FtZVBsYXkuYm9hcmRTaXplKTtcbiAgICAgIHRoaXMuZ2FtZVBsYXkucmVkcmF3UG9zaXRpb25zKHBvc2l0aW9uKTtcbiAgICB9LCAxMDAwKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4gY2xlYXJJbnRlcnZhbCh0aW1lcklkKSwgMTAwMDAwMCk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJjYWxjVGlsZVR5cGUiLCJpbmRleCIsImJvYXJkU2l6ZSIsImlzVG9wUm93IiwiaXNCb3R0b21Sb3ciLCJpc0xlZnRDb2x1bW4iLCJpc1JpZ2h0Q29sdW1uIiwibGFzdFBvc2l0aW9uIiwiY3JlYXRlUG9zaXRpb24iLCJjZWxscyIsInRvdGFsQ2VsbHMiLCJBcnJheSIsImZyb20iLCJsZW5ndGgiLCJfIiwiaSIsImZsYXRNYXAiLCJjZWxsIiwiY3JlYXRlQXJyYXlQb3NpdGlvbnMiLCJyYW5kIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYXV0byIsInBvaW50ZXIiLCJjcm9zc2hhaXIiLCJub3RhbGxvd2VkIiwiZ2FtZVBsYXkiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJjb250YWluZXIiLCJib2FyZEVsIiwiY2VsbENsaWNrTGlzdGVuZXJzIiwiY2VsbEVudGVyTGlzdGVuZXJzIiwiY2VsbExlYXZlTGlzdGVuZXJzIiwiYmluZFRvRE9NIiwiSFRNTEVsZW1lbnQiLCJFcnJvciIsImRyYXdVaSIsInRoZW1lIiwiY2hlY2tCaW5kaW5nIiwiaW5uZXJIVE1MIiwicXVlcnlTZWxlY3RvciIsImNsYXNzTGlzdCIsImFkZCIsImNlbGxFbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsIm9uQ2VsbEVudGVyIiwib25DZWxsTGVhdmUiLCJvbkNlbGxDbGljayIsImFwcGVuZENoaWxkIiwiY2hpbGRyZW4iLCJyZWRyYXdQb3NpdGlvbnMiLCJwb3NpdGlvbiIsImNoYXJFbCIsImFkZENlbGxFbnRlckxpc3RlbmVyIiwiY2FsbGJhY2siLCJwdXNoIiwiYWRkQ2VsbExlYXZlTGlzdGVuZXIiLCJhZGRDZWxsQ2xpY2tMaXN0ZW5lciIsInByZXZlbnREZWZhdWx0IiwiaW5kZXhPZiIsImN1cnJlbnRUYXJnZXQiLCJmb3JFYWNoIiwibyIsImNhbGwiLCJzZWxlY3RDZWxsIiwiY29sb3IiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJkZXNlbGVjdENlbGwiLCJyZW1vdmUiLCJmaWx0ZXIiLCJzdGFydHNXaXRoIiwiaGlkZUNlbGxUb29sdGlwIiwidGl0bGUiLCJzZXRDdXJzb3IiLCJjdXJzb3IiLCJzdHlsZSIsImdhbWVDdHJsIiwiaW5kZXhTZWxlY3QiLCJiaW5kIiwiaW5pdCIsImV2ZW50cyIsInNob3dDaGFyYWN0ZXIiLCJjdXJzb3JzIiwicmVkIiwidGltZXJJZCIsInNldEludGVydmFsIiwic2V0VGltZW91dCIsImNsZWFySW50ZXJ2YWwiXSwic291cmNlUm9vdCI6IiJ9